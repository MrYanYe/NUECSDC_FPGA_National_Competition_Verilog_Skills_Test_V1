`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 2025/11/18 14:54:33
// Design Name: 
// Module Name: game_count
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////

module game_count(
    input rst_n, 
    input clk, 
    input [9:0]money,
    input set,
    input [1:0]boost,
    output [9:0]remain,
    output yellow,
    output red
);

reg [9:0] reamin_reg = 0;
assign remain = reamin_reg;
reg yellow_reg;
assign yellow = yellow_reg;
reg red_reg;
assign red = red_reg;

parameter       IDLE        = 2'b00;
parameter       NORMAL      = 2'b01;
parameter       PLAY        = 2'b10;
parameter       TRIAL       = 2'b11;
reg [1:0] state = IDLE;

reg trial_count = 1;
reg [4:0] trial_time_spent = 0;

// reset
always @( posedge clk or negedge rst_n )
begin
    if (!rst_n)
    begin
        reamin_reg = 0;
        trial_count = 1;
        trial_time_spent = 0;
    end

    else
    begin
        // top up
        if ( set )
        begin
            reamin_reg = reamin_reg + money;
        end

        // Light Warning
        if ( state != IDLE )
        begin
            if ( reamin_reg < 10  )
            begin
                yellow_reg = 1;
            end

            if ( reamin_reg == 0  )
            begin
                red_reg = 1;
            end
        end

        // Judge State

        if ( boost == TRIAL )
        begin
            if ( trial_count > 0 )
            begin
                state = TRIAL;
            end
            else
                state = state;

        end
        else
        begin
            state = boost;
        end

        // Play
        if ( reamin_reg > 0 )
        begin
            case (state)
                IDLE:
                begin
                    ;


                end

                NORMAL:
                begin
                    ;
                    reamin_reg = reamin_reg - 1;

                end

                PLAY:
                begin
                    
                    reamin_reg = reamin_reg - 2;

                end

                TRIAL:
                begin
                    
                    reamin_reg = reamin_reg;

                    if (trial_time_spent == 4)
                    begin
                        ;
                        state = NORMAL;
                        trial_count = trial_count - 1;
                        trial_time_spent = 0;
                    end
                    else
                    begin
                        trial_time_spent = trial_time_spent + 1;
                    end


                end

                default: 
                begin
                    state = IDLE;
                end

            endcase
        end // if ( reamin_reg > 0 )








    end // rst_n else

end









endmodule
